<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#f7f3ee" />
  <title>Puntos Dieta</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css" />
  <!-- Firebase JS SDKs for Auth and Firestore -->
  <!-- These scripts bring in Firebase (compat) so that firebase.auth() and firebase.firestore() are available.
       Replace the version (9.23.0) with the latest if desired. -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <button class="icon-btn" id="menuBtn" aria-label="Menú">
        <span class="icon">☰</span>
      </button>

      <div class="brand">
        <!-- Cambiar AM por PM para el título PMSALUD -->
        <div class="brand-top">PM<span class="brand-light">SALUD</span></div>
        <div class="brand-flourish" aria-hidden="true">❦</div>
      </div>

      <button class="icon-btn" id="infoBtn" aria-label="Info">
        <span class="icon">i</span>
      </button>
    </header>

    <main class="content">
      <section class="hero">
        <div class="wood-card">
          <div class="dayrow">
            <button class="daylink" id="prevDayBtn">‹ Ayer</button>
            <button class="daytitle" id="dayTitle" title="Cambiar fecha"></button>
            <button class="daylink" id="nextDayBtn">Mañana ›</button>
          </div>

          <div class="big-gauge" id="bigGauge" role="img" aria-label="Puntos restantes">
            <div class="big-gauge-inner">
              <div class="big-number" id="remainingTotal">0</div>
              <div class="big-label" id="bigLabel">Puntos restantes</div>
            </div>
          </div>

          <div class="tabs" role="tablist" aria-label="Modo de vista">
            <button class="tab active" data-mode="remaining" role="tab" aria-selected="true">Puntos</button>
            <button class="tab" data-mode="used" role="tab" aria-selected="false">Usados</button>
          </div>
        </div>
      </section>

      <section class="grid" id="grid"></section>

      <section class="weight-section">
        <div class="wood-card">
          <div class="weight-header">
            <div>
              <div class="weight-title">Peso del día</div>
              <div class="weight-subtitle" id="weightValue">Sin registro</div>
            </div>
            <div class="weight-input">
              <label class="field">
                <span>Hoy (kg)</span>
                <input id="weightInput" inputmode="decimal" placeholder="Ej. 72.5" />
              </label>
              <button class="btn primary" id="saveWeightBtn" type="button">Guardar peso</button>
            </div>
          </div>
          <div class="weight-chart">
            <div class="weight-empty" id="weightChartEmpty">Agrega tu peso para ver la gráfica diaria.</div>
            <svg id="weightChart" viewBox="0 0 320 120" aria-label="Gráfica de peso por día" role="img"></svg>
            <div class="weight-labels" id="weightLabels"></div>
          </div>
        </div>
      </section>
    </main>

    <!-- Drawer -->
    <aside class="drawer" id="drawer" aria-hidden="true">
      <div class="drawer-scrim" id="drawerScrim"></div>
      <div class="drawer-panel" role="dialog" aria-modal="true" aria-label="Menú">
        <div class="drawer-header">
          <div class="drawer-title">Opciones</div>
          <button class="icon-btn" id="drawerCloseBtn" aria-label="Cerrar">✕</button>
        </div>
        <div class="drawer-body">
          <button class="list-btn" id="resetDayBtn">Reiniciar día</button>
          <button class="list-btn" id="exportBtn">Exportar / Importar</button>
          <button class="list-btn danger" id="logoutBtn">Cerrar sesión</button>
          <button class="list-btn" id="aboutBtn">Acerca de</button>
        </div>
      </div>
    </aside>

    <!-- Modal: Category -->
    <div class="modal" id="catModal" aria-hidden="true">
      <div class="modal-scrim" data-close="1"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-label="Editar puntos">
        <div class="modal-head">
          <div class="modal-title" id="modalTitle">Categoría</div>
          <button class="icon-btn" id="modalCloseBtn" aria-label="Cerrar">✕</button>
        </div>
        <div class="modal-body">
          <div class="statrow">
            <div class="stat">
              <div class="stat-label">Meta</div>
              <div class="stat-value" id="modalGoal">0</div>
            </div>
            <div class="stat">
              <div class="stat-label">Usados</div>
              <div class="stat-value" id="modalUsed">0</div>
            </div>
            <div class="stat">
              <div class="stat-label">Restantes</div>
              <div class="stat-value" id="modalRem">0</div>
            </div>
          </div>

          <div class="quick">
            <div class="quick-title">¿Cuántos puntos comiste?</div>
            <div class="quick-grid">
              <button class="chip" data-add="0.5">+0.5</button>
              <button class="chip" data-add="1">+1</button>
              <button class="chip" data-add="2">+2</button>
              <button class="chip" data-add="3">+3</button>
            </div>

            <div class="custom">
              <label class="field">
                <span>Personalizado</span>
                <input id="customInput" inputmode="decimal" placeholder="Ej. 1.5" />
              </label>
              <div class="custom-actions">
                <button class="btn primary" id="addCustomBtn">Sumar</button>
                <button class="btn" id="subCustomBtn">Restar</button>
              </div>
            </div>

            <div class="undo-row">
              <button class="btn danger" id="undoBtn">Deshacer último</button>
            </div>
          </div>

          <div class="divider"></div>

          <div class="edit-goal">
            <div class="quick-title">Ajustar meta de esta categoría</div>
            <div class="custom">
              <label class="field">
                <span>Nueva meta</span>
                <input id="goalInput" inputmode="decimal" placeholder="Ej. 6" />
              </label>
              <div class="custom-actions">
                <button class="btn" id="saveGoalBtn">Guardar meta</button>
              </div>
              <div class="hint">Tip: también puedes editar la meta total desde “Editar meta”.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Goal -->
    <div class="modal" id="goalModal" aria-hidden="true">
      <div class="modal-scrim" data-close="1"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-label="Editar meta total">
        <div class="modal-head">
          <div class="modal-title">Meta total de puntos</div>
          <button class="icon-btn" id="goalCloseBtn" aria-label="Cerrar">✕</button>
        </div>
        <div class="modal-body">
          <p class="p">Define cuántos puntos totales tienes para el día. El medidor superior usa esta cifra.</p>
          <label class="field">
            <span>Meta total</span>
            <input id="totalGoalInput" inputmode="decimal" placeholder="Ej. 22" />
          </label>

          <div class="custom-actions">
            <button class="btn primary" id="saveTotalGoalBtn">Guardar</button>
            <button class="btn" id="autoFromCatsBtn">Calcular desde categorías</button>
          </div>

          <div class="hint">Todo se guarda en tu iPhone (localStorage). No se sube a ningún servidor.</div>
        </div>
      </div>
    </div>

    <!-- Modal: Export -->
    <div class="modal" id="exportModal" aria-hidden="true">
      <div class="modal-scrim" data-close="1"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-label="Exportar o importar">
        <div class="modal-head">
          <div class="modal-title">Exportar / Importar</div>
          <button class="icon-btn" id="exportCloseBtn" aria-label="Cerrar">✕</button>
        </div>
        <div class="modal-body">
          <p class="p">Copia/pega este JSON para respaldar tu información o moverla a otro iPhone.</p>
          <textarea id="exportArea" spellcheck="false"></textarea>
          <div class="custom-actions">
            <button class="btn" id="copyExportBtn">Copiar</button>
            <button class="btn primary" id="importBtn">Importar (reemplaza)</button>
          </div>
          <div class="hint">Si importas, se reemplaza todo lo que tienes guardado.</div>
        </div>
      </div>
    </div>

    <!-- Date picker (hidden) -->
    <input type="date" id="datePicker" class="date-picker" />

    <footer class="footer-safe"></footer>
  </div>

  <!-- Login screen overlay. Visible when the user is not authenticated. -->
  <div class="login-screen" id="loginScreen" aria-hidden="false">
    <div class="login-card">
      <h2>Iniciar sesión</h2>
      <label class="field">
        <span>Email</span>
        <input id="loginEmail" type="email" autocomplete="username" />
      </label>
      <label class="field">
        <span>Contraseña</span>
        <input id="loginPassword" type="password" autocomplete="current-password" />
      </label>
      <div class="custom-actions">
        <button class="btn primary" type="button" id="loginBtn">Entrar</button>
        <button class="btn" type="button" id="signupBtn">Crear cuenta</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
